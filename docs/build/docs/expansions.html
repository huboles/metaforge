<!doctypehtml><html><head><title>expansions</title><meta content="expanding variables and patterns in a file"name=description><meta content="huck boles"name=author></head><body><a href=../index.html>home</a><div><h1><strong>expansions</strong> - <em>0.1.3</em></h1></div><p>expanding variables and patterns in a file</p><article><h2 id=syntax>syntax</h2><p>a sigil followed by braces, with an identifier inside.</p><p>happens inside the source, expanding to the relevant value when the file is built</p><h3 id=examples>examples</h3><pre><code>...this is a string with a ${variable} to be expanded...

...this line has a &{pattern} inside of it...

...this @{array} will be replaced...</code></pre><h2 id=behavior>behavior</h2><p>all expansions are decided by the value defined for the identifier, following inheritance rules, and directory masking for variables and arrays.</p><h3 id=variables>variables</h3><p>variables are simply replaced by the defined value, with no other substitution. they’re useful for small things that are frequently changed in a pattern, but don’t need any extra expansion.</p><h4 id=example>example</h4><pre><code>definition:
    ${ 
       baz = "foo"
       bar.baz = "quux"
       quux = BLANK
    }

pattern [foo]: &LTp>${baz} ${ quux}&LT/p>

expanded [foo]: &LTp>foo &LT/p>

pattern [bar]: &LTp>${baz} ${ quux}&LT/p>

expanded [bar]: &LTp>quux &LT/p></code></pre><h3 id=arrays>arrays</h3><p>arrays are similar to variables, but are closely related to the masking pattern. after all expansions happen in a pattern, each defined array maps its contents across copies of the pattern, resulting in a easy method for duplicating repetitive parts of patterns.</p><h4 id=example-1>example</h4><pre><code>pattern [foo]: &LTp>@{bar}&LT/p>

defintion: @{  foo.bar = ['foo', 'bar', 'baz'] }

expands to: &LTp>foo&LT/p>&LTp>bar&LT/p>&LTp>baz&LT/p></code></pre><p>it’s generally best to keep arrays inside small self-contained patterns, otherwise unwanted parts of the file may be duplicated.</p><h3 id=patterns>patterns</h3><p>patterns expand by looking for files using the pattern directory as a root. the identifier becomes a directory by changing .’s to /’s. if a defined value exists, it’s used as the filename, with a <strong>.meta</strong> extension added automatically. if no value is defined, metaforge next looks for files with the exact name in the identifier, again substituting .’s to /’s. if a file still hasn’t been found, or the pattern has most recently been defined as <strong><em>DEFAULT</em></strong>, then <strong>default.meta</strong> is selected from the identified directory.</p><h4 id=example-search>example search</h4><pre><code>foo.bar => pattern/foo/bar/*.meta => pattern/foo/bar.meta => pattern/foo/bar/default.meta</code></pre><p>if no file is found metaforge will either insert an empty string, or panic depending on the flags and header settings in effect. a pattern defined as <strong><em>BLANK</em></strong> will always expand to a blank string without errors.</p><p>if the identifier in the pattern is <strong><em>SOURCE</em></strong>, the pattern will expand using the processed source from the original calling file in the source directory. this goes through an extra step right before insertion, calling pandoc on the file to convert between the chosen filetypes.</p><p>once the filename is determined, it is parsed and expands any contained variables, arrays and patterns. if it is a <strong><em>SOURCE</em></strong> pattern, it is converted to html after the expansions. the expanded pattern is then inserted in place of the calling identifier.</p><h2 id=building>building</h2><p>as each file is built, the first thing expanded is the relevant <strong>base/[FILE].meta</strong> pattern, so it is required to have at least a <strong>default.meta</strong> in the <strong>pattern/base</strong> directory</p><h3 id=example-2>example</h3><pre><code>pattern [base]: &LThtml>&{body}&LT/html>

pattern [body]: &LTbody>&{SOURCE}&LT/body>

source [SOURCE]: foo *bar* baz

expanded [base] : &LThtml>&LTbody>&LTp>foo &LTitalic>bar&LT/italic> baz&LT/p>&LT/body>&LT/html></code></pre></article></body><foot> made with <strong>metaforge</strong> </foot></html>